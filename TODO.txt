# Project Star TODO List

## Changelog

### 2025-02-24
- Updated sensor HALs to use new logging format:
  - Converted BH1750 sensor HAL from ESP_LOG* to log_*
  - Converted MQ135 sensor HAL from ESP_LOG* to log_*
  - MQ135 has better error handling and logging
- Updated controller HALs to use new logging format:
  - Converted PCA9685 motor controller HAL from ESP_LOG* to log_*
  - Converted EC11 encoder HAL from ESP_LOG* to log_*

### 2025-02-23 
- Updated sensor HALs to use new logging format:
  - Converted DHT22 sensor HAL from ESP_LOG* to log_*
  - Converted GY-NEO6MV2 GPS HAL from ESP_LOG* to log_*
  - Converted MPU6050 motion sensor HAL from ESP_LOG* to log_*
  - Converted QMC5883L compass HAL from ESP_LOG* to log_*
  - Converted OV7670 camera HAL from ESP_LOG* to log_*
  - Converted CCS811 air quality sensor HAL from ESP_LOG* to log_*
- Added descriptive action and status messages to all log calls
- Maintained existing functionality while updating log format

### 2025-02-22
- Initial TODO list creation
- Organized tasks by priority and component
- Added system-wide tasks for stability and testing
- Implemented core logging system with inline functions and proper variadic argument handling

## Tasks

### Critical Tasks

#### Log Handler Implementation
- [x] Create Unified Log Handler
  - [x] Implement consistent log format across all components
  - [x] Add component identification
  - [x] Add log level indicators
  - [ ] Add timestamp to all log messages
  - [ ] Add sequence numbers for message ordering
  - [ ] Add thread/task ID for multi-threaded debugging
- [ ] Log Storage and Management
  - [ ] Implement log rotation
  - [ ] Add log compression for storage efficiency
  - [ ] Add log filtering capabilities
  - [ ] Implement log persistence across reboots
  - [ ] Add log retrieval interface
- [ ] Log Analysis Tools
  - [ ] Add log parsing utilities
  - [ ] Implement log level filtering
  - [ ] Add search functionality
  - [ ] Create log visualization tools
  - [ ] Add statistical analysis features
- [ ] Integration with Existing Components
  - [x] Update error handler to use new log format
  - [x] Update sensor HALs to use new log format:
    - [x] DHT22 sensor HAL
    - [x] GY-NEO6MV2 GPS HAL
    - [x] MPU6050 motion sensor HAL
    - [x] QMC5883L compass HAL
    - [x] OV7670 camera HAL
    - [x] CCS811 air quality sensor HAL
    - [x] BH1750 sensor HAL
    - [x] MQ135 sensor HAL
  - [x] Update controller HALs to use new log format:
    - [x] PCA9685 motor controller HAL
    - [x] EC11 encoder HAL
  - [ ] Update system tasks to use new log format:
    - [ ] Motor tasks (motor_tasks.c)
    - [ ] Sensor tasks (sensor_tasks.c)
    - [ ] Camera tasks
    - [ ] GPS tasks
    - [ ] Wifi tasks (wifi_tasks.c)
    - [ ] System tasks (system_tasks.c)
    - [ ] Webserver tasks (webserver_tasks.c)
  - [ ] Update managers to use new log format:
    - [ ] File write manager (file_write_manager.c)
    - [ ] Time manager (time_manager.c)
  - [ ] Update common components to use new log format:
    - [ ] Log handler (log_handler.c)
    - [ ] Error handler (error_handler.c)
    - [ ] I2C (i2c.c)
    - [ ] UART (uart.c)
  - [ ] Update HALs to use new log format:
    - [ ] SD Card HAL (sd_card_hal.c)
  - [ ] Update main and modules to use new log format:
    - [ ] main.c
    - [ ] gait_movement.c
    - [ ] hexapod_geometry.c
  - [ ] Update remaining ESP_LOGx instances:
    - [ ] error_handler.c
    - [ ] i2c.c
    - [ ] uart.c
    - [ ] ccs811_hal.c
    - [ ] dht22_hal.c
    - [ ] gy_neo6mv2_hal.c
    - [ ] mpu6050_hal.c
    - [ ] qmc5883l_hal.c
    - [ ] sd_card_hal.c
    - [ ] motor_tasks.c
    - [ ] sensor_tasks.c
    - [ ] system_tasks.c
    - [ ] webserver_tasks.c
    - [ ] wifi_tasks.c
- [ ] Ensure all log messages that include unsigned integers use `%u` instead of `%d` for proper formatting.

#### Code Cleanup and Standardization
- [ ] Review and standardize inline function usage:
  - [ ] Audit all .c files for inline functions that should be in headers
  - [ ] Move appropriate inline functions to header files
  - [ ] Document inline function usage guidelines
  - [ ] Add static analysis checks for inline function placement
- [ ] Function Attributes and Safety:
  - [ ] Add format attributes to all printf-style functions
  - [ ] Review and fix variadic argument handling
  - [ ] Add null pointer checks to all public functions
  - [ ] Add range validation for critical parameters

#### Error Handling
- [ ] Core Components Error Handler Integration
  - [ ] DHT22 sensor
  - [ ] GY-NEO6MV2 GPS module
  - [ ] MPU6050 motion sensor
  - [ ] QMC5883L compass
  - [ ] SD Card module
- [ ] Error Handler Implementation
  - [ ] Initialize error handlers in sensor initialization functions
  - [ ] Implement reset error handler functionality
  - [ ] Add exponential backoff for all components
- [ ] System-wide Error Management
  - [ ] Implement consistent error handling across components
  - [ ] Add comprehensive system diagnostics
  - [ ] Create standardized logging function:
    - [ ] Format: log(tag, level, action, status, [details])
    - [ ] Example: log(system_tag, ESP_LOGI, "Starting sensor initialization", "In Progress", "Configuring I2C")
    - [ ] Auto-formats as: "- Starting sensor initialization - In Progress - Configuring I2C"
    - [ ] Support variable arguments for dynamic content
    - [ ] Maintain ESP-IDF log levels (ESP_LOGE, ESP_LOGW, ESP_LOGI, etc.)
  - [ ] Enhance error reporting and logging

#### System Stability
- [ ] Memory Management
  - [ ] Add memory usage monitoring
  - [ ] Implement memory leak detection
  - [ ] Add heap fragmentation monitoring
- [ ] Task Management
  - [ ] Implement task watchdog
  - [ ] Add task stack monitoring
  - [ ] Optimize task priorities and scheduling

### High Priority Tasks

#### Sensors
- [ ] MPU6050 Configuration and Integration
  - [ ] Configure sensor values for accuracy
  - [ ] Implement interrupt handler using GPIO_NUM_26
  - [ ] Add proper integration with the system
  - [ ] Implement motion detection alerts

- [ ] OV7670 Camera
  - [ ] Complete camera configurations
  - [ ] Add support for all 6 cameras
  - [ ] Re-enable camera monitoring task
  - [ ] Implement frame buffering system
  - [ ] Add camera synchronization mechanism

- [ ] GPS (GY-NEO6MV2)
  - [ ] Complete GPS integration
  - [ ] Fix current non-working state
  - [ ] Add position accuracy validation
  - [ ] Implement geofencing capabilities

#### Storage
- [ ] SD Card Improvements
  - [ ] Implement CD (Card Detect) functionality
  - [ ] Add SDIO support
  - [ ] Test and verify SD card operations
  - [ ] Add filesystem integrity checks
  - [ ] Implement data backup mechanism

### Medium Priority Tasks

#### Motor Control
- [ ] Gait Implementation
  - [ ] Implement tripod_gait() function
  - [ ] Implement wave_gait() function
  - [ ] Implement ripple_gait() function
  - [ ] Implement quadruped_gait() function
  - [ ] Verify accuracy of motor movement calculations
  - [ ] Add smooth transition between gaits

- [ ] Motor Mapping
  - [ ] Map motors with their identifications (hip/femur/tibia)
  - [ ] Determine custom values for each motor's max/min angles
  - [ ] Add motor calibration routine
  - [ ] Implement motor position feedback

#### Controllers
- [ ] EC11 Encoder
  - [ ] Integrate the MCP23018
  - [ ] Initialize EC11 encoders properly
  - [ ] Test functionality
  - [ ] Replace hardcoded implementation for first 3 motors
  - [ ] Add position persistence
  - [ ] Implement emergency stop functionality

#### Measurements
- [ ] Physical Measurements
  - [ ] Replace placeholder values with actual measurements:
    - [ ] hip_length_cm (currently 5.0f)
    - [ ] femur_length_cm (currently 10.0f)
    - [ ] tibia_length_cm (currently 12.0f)
  - [ ] Add calibration procedure
  - [ ] Document measurement process

### Low Priority Tasks

#### Sensors
- [ ] CCS811 Air Quality Sensor
  - [ ] Fix non-working state
  - [ ] Complete integration
  - [ ] Add air quality alerts
  - [ ] Implement sensor warmup handling

#### System Management
- [ ] File Management
  - [ ] Test file_write_manager functionality
  - [ ] Implement consistent logging across files
  - [ ] Add log rotation
  - [ ] Implement data compression

- [ ] Time Management
  - [ ] Make time synchronization non-blocking
  - [ ] Add NTP fallback mechanisms
  - [ ] Implement timezone handling

#### Documentation
- [ ] Code Documentation
  - [ ] Add inline documentation for all functions
  - [ ] Create API documentation
  - [ ] Add system architecture diagrams
  - [ ] Document error codes and recovery procedures

#### Testing
- [ ] Test Infrastructure
  - [ ] Create unit tests for each component
  - [ ] Add integration tests
  - [ ] Implement automated testing
  - [ ] Add performance benchmarks

## Notes
- All tasks are extracted from codebase analysis
- Priority is assigned based on dependencies and impact
- Some tasks may have interdependencies
- Tasks marked as "Critical" affect system stability
- Use checkboxes to track progress: [x] for completed, [ ] for pending
- Update changelog when making significant changes 